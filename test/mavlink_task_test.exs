defmodule Mavlink.Test.Tasks do
  use ExUnit.Case
  import Mix.Tasks.Mavlink
  
  @input "#{File.cwd!}/test/input/common.xml"
  @output "#{File.cwd!}/test/output/Mavlink.ex"
 
  test "generate" do
    File.rm(@output)
    run([
      "generate",
      @input,
      @output])
    assert File.exists?(@output)
    pairs = Enum.zip([
      Elixir.Mavlink,
      Elixir.Mavlink.ActuatorControlTarget,
      Elixir.Mavlink.ActuatorOutputStatus,
      Elixir.Mavlink.AdsbVehicle,
      Elixir.Mavlink.Altitude,
      Elixir.Mavlink.AttPosMocap,
      Elixir.Mavlink.Attitude,
      Elixir.Mavlink.AttitudeQuaternion,
      Elixir.Mavlink.AttitudeQuaternionCov,
      Elixir.Mavlink.AttitudeTarget,
      Elixir.Mavlink.AuthKey,
      Elixir.Mavlink.AutopilotVersion,
      Elixir.Mavlink.BatteryStatus,
      Elixir.Mavlink.ButtonChange,
      Elixir.Mavlink.CameraCaptureStatus,
      Elixir.Mavlink.CameraImageCaptured,
      Elixir.Mavlink.CameraInformation,
      Elixir.Mavlink.CameraSettings,
      Elixir.Mavlink.CameraTrigger,
      Elixir.Mavlink.CellularStatus,
      Elixir.Mavlink.ChangeOperatorControl,
      Elixir.Mavlink.ChangeOperatorControlAck,
      Elixir.Mavlink.Collision,
      Elixir.Mavlink.CommandAck,
      Elixir.Mavlink.CommandInt,
      Elixir.Mavlink.CommandLong,
      Elixir.Mavlink.ControlSystemState,
      Elixir.Mavlink.DataStream,
      Elixir.Mavlink.DataTransmissionHandshake,
      Elixir.Mavlink.Debug,
      Elixir.Mavlink.DebugFloatArray,
      Elixir.Mavlink.DebugVect,
      Elixir.Mavlink.DistanceSensor,
      Elixir.Mavlink.EncapsulatedData,
      Elixir.Mavlink.EstimatorStatus,
      Elixir.Mavlink.ExtendedSysState,
      Elixir.Mavlink.FileTransferProtocol,
      Elixir.Mavlink.FlightInformation,
      Elixir.Mavlink.FollowTarget,
      Elixir.Mavlink.GlobalPositionInt,
      Elixir.Mavlink.GlobalPositionIntCov,
      Elixir.Mavlink.GlobalVisionPositionEstimate,
      Elixir.Mavlink.Gps2Raw,
      Elixir.Mavlink.Gps2Rtk,
      Elixir.Mavlink.GpsGlobalOrigin,
      Elixir.Mavlink.GpsInjectData,
      Elixir.Mavlink.GpsInput,
      Elixir.Mavlink.GpsRawInt,
      Elixir.Mavlink.GpsRtcmData,
      Elixir.Mavlink.GpsRtk,
      Elixir.Mavlink.GpsStatus,
      Elixir.Mavlink.Heartbeat,
      Elixir.Mavlink.HighLatency,
      Elixir.Mavlink.HighLatency2,
      Elixir.Mavlink.HighresImu,
      Elixir.Mavlink.HilActuatorControls,
      Elixir.Mavlink.HilControls,
      Elixir.Mavlink.HilGps,
      Elixir.Mavlink.HilOpticalFlow,
      Elixir.Mavlink.HilRcInputsRaw,
      Elixir.Mavlink.HilSensor,
      Elixir.Mavlink.HilState,
      Elixir.Mavlink.HilStateQuaternion,
      Elixir.Mavlink.HomePosition,
      Elixir.Mavlink.IsbdLinkStatus,
      Elixir.Mavlink.LandingTarget,
      Elixir.Mavlink.LinkNodeStatus,
      Elixir.Mavlink.LocalPositionNed,
      Elixir.Mavlink.LocalPositionNedCov,
      Elixir.Mavlink.LocalPositionNedSystemGlobalOffset,
      Elixir.Mavlink.LogData,
      Elixir.Mavlink.LogEntry,
      Elixir.Mavlink.LogErase,
      Elixir.Mavlink.LogRequestData,
      Elixir.Mavlink.LogRequestEnd,
      Elixir.Mavlink.LogRequestList,
      Elixir.Mavlink.LoggingAck,
      Elixir.Mavlink.LoggingData,
      Elixir.Mavlink.LoggingDataAcked,
      Elixir.Mavlink.ManualControl,
      Elixir.Mavlink.ManualSetpoint,
      Elixir.Mavlink.MemoryVect,
      Elixir.Mavlink.MessageInterval,
      Elixir.Mavlink.MissionAck,
      Elixir.Mavlink.MissionChanged,
      Elixir.Mavlink.MissionClearAll,
      Elixir.Mavlink.MissionCount,
      Elixir.Mavlink.MissionCurrent,
      Elixir.Mavlink.MissionItem,
      Elixir.Mavlink.MissionItemInt,
      Elixir.Mavlink.MissionItemReached,
      Elixir.Mavlink.MissionRequest,
      Elixir.Mavlink.MissionRequestInt,
      Elixir.Mavlink.MissionRequestList,
      Elixir.Mavlink.MissionRequestPartialList,
      Elixir.Mavlink.MissionSetCurrent,
      Elixir.Mavlink.MissionWritePartialList,
      Elixir.Mavlink.MountOrientation,
      Elixir.Mavlink.NamedValueFloat,
      Elixir.Mavlink.NamedValueInt,
      Elixir.Mavlink.NavControllerOutput,
      Elixir.Mavlink.ObstacleDistance,
      Elixir.Mavlink.Odometry,
      Elixir.Mavlink.OpticalFlow,
      Elixir.Mavlink.OpticalFlowRad,
      Elixir.Mavlink.OrbitExecutionStatus,
      Elixir.Mavlink.ParamExtAck,
      Elixir.Mavlink.ParamExtRequestList,
      Elixir.Mavlink.ParamExtRequestRead,
      Elixir.Mavlink.ParamExtSet,
      Elixir.Mavlink.ParamExtValue,
      Elixir.Mavlink.ParamMapRc,
      Elixir.Mavlink.ParamRequestList,
      Elixir.Mavlink.ParamRequestRead,
      Elixir.Mavlink.ParamSet,
      Elixir.Mavlink.ParamValue,
      Elixir.Mavlink.Ping,
      Elixir.Mavlink.PlayTune,
      Elixir.Mavlink.PositionTargetGlobalInt,
      Elixir.Mavlink.PositionTargetLocalNed,
      Elixir.Mavlink.PowerStatus,
      Elixir.Mavlink.ProtocolVersion,
      Elixir.Mavlink.RadioStatus,
      Elixir.Mavlink.RawImu,
      Elixir.Mavlink.RawPressure,
      Elixir.Mavlink.RcChannels,
      Elixir.Mavlink.RcChannelsOverride,
      Elixir.Mavlink.RcChannelsRaw,
      Elixir.Mavlink.RcChannelsScaled,
      Elixir.Mavlink.RequestDataStream,
      Elixir.Mavlink.ResourceRequest,
      Elixir.Mavlink.SafetyAllowedArea,
      Elixir.Mavlink.SafetySetAllowedArea,
      Elixir.Mavlink.ScaledImu,
      Elixir.Mavlink.ScaledImu2,
      Elixir.Mavlink.ScaledImu3,
      Elixir.Mavlink.ScaledPressure,
      Elixir.Mavlink.ScaledPressure2,
      Elixir.Mavlink.ScaledPressure3,
      Elixir.Mavlink.Send,
      Elixir.Mavlink.Send.Atom,
      Elixir.Mavlink.Send.BitString,
      Elixir.Mavlink.Send.Float,
      Elixir.Mavlink.Send.Function,
      Elixir.Mavlink.Send.Integer,
      Elixir.Mavlink.Send.List,
      Elixir.Mavlink.Send.Map,
      Elixir.Mavlink.Send.Mavlink.ActuatorControlTarget,
      Elixir.Mavlink.Send.Mavlink.ActuatorOutputStatus,
      Elixir.Mavlink.Send.Mavlink.AdsbVehicle,
      Elixir.Mavlink.Send.Mavlink.Altitude,
      Elixir.Mavlink.Send.Mavlink.AttPosMocap,
      Elixir.Mavlink.Send.Mavlink.Attitude,
      Elixir.Mavlink.Send.Mavlink.AttitudeQuaternion,
      Elixir.Mavlink.Send.Mavlink.AttitudeQuaternionCov,
      Elixir.Mavlink.Send.Mavlink.AttitudeTarget,
      Elixir.Mavlink.Send.Mavlink.AuthKey,
      Elixir.Mavlink.Send.Mavlink.AutopilotVersion,
      Elixir.Mavlink.Send.Mavlink.BatteryStatus,
      Elixir.Mavlink.Send.Mavlink.ButtonChange,
      Elixir.Mavlink.Send.Mavlink.CameraCaptureStatus,
      Elixir.Mavlink.Send.Mavlink.CameraImageCaptured,
      Elixir.Mavlink.Send.Mavlink.CameraInformation,
      Elixir.Mavlink.Send.Mavlink.CameraSettings,
      Elixir.Mavlink.Send.Mavlink.CameraTrigger,
      Elixir.Mavlink.Send.Mavlink.CellularStatus,
      Elixir.Mavlink.Send.Mavlink.ChangeOperatorControl,
      Elixir.Mavlink.Send.Mavlink.ChangeOperatorControlAck,
      Elixir.Mavlink.Send.Mavlink.Collision,
      Elixir.Mavlink.Send.Mavlink.CommandAck,
      Elixir.Mavlink.Send.Mavlink.CommandInt,
      Elixir.Mavlink.Send.Mavlink.CommandLong,
      Elixir.Mavlink.Send.Mavlink.ControlSystemState,
      Elixir.Mavlink.Send.Mavlink.DataStream,
      Elixir.Mavlink.Send.Mavlink.DataTransmissionHandshake,
      Elixir.Mavlink.Send.Mavlink.Debug,
      Elixir.Mavlink.Send.Mavlink.DebugFloatArray,
      Elixir.Mavlink.Send.Mavlink.DebugVect,
      Elixir.Mavlink.Send.Mavlink.DistanceSensor,
      Elixir.Mavlink.Send.Mavlink.EncapsulatedData,
      Elixir.Mavlink.Send.Mavlink.EstimatorStatus,
      Elixir.Mavlink.Send.Mavlink.ExtendedSysState,
      Elixir.Mavlink.Send.Mavlink.FileTransferProtocol,
      Elixir.Mavlink.Send.Mavlink.FlightInformation,
      Elixir.Mavlink.Send.Mavlink.FollowTarget,
      Elixir.Mavlink.Send.Mavlink.GlobalPositionInt,
      Elixir.Mavlink.Send.Mavlink.GlobalPositionIntCov,
      Elixir.Mavlink.Send.Mavlink.GlobalVisionPositionEstimate,
      Elixir.Mavlink.Send.Mavlink.Gps2Raw,
      Elixir.Mavlink.Send.Mavlink.Gps2Rtk,
      Elixir.Mavlink.Send.Mavlink.GpsGlobalOrigin,
      Elixir.Mavlink.Send.Mavlink.GpsInjectData,
      Elixir.Mavlink.Send.Mavlink.GpsInput,
      Elixir.Mavlink.Send.Mavlink.GpsRawInt,
      Elixir.Mavlink.Send.Mavlink.GpsRtcmData,
      Elixir.Mavlink.Send.Mavlink.GpsRtk,
      Elixir.Mavlink.Send.Mavlink.GpsStatus,
      Elixir.Mavlink.Send.Mavlink.Heartbeat,
      Elixir.Mavlink.Send.Mavlink.HighLatency,
      Elixir.Mavlink.Send.Mavlink.HighLatency2,
      Elixir.Mavlink.Send.Mavlink.HighresImu,
      Elixir.Mavlink.Send.Mavlink.HilActuatorControls,
      Elixir.Mavlink.Send.Mavlink.HilControls,
      Elixir.Mavlink.Send.Mavlink.HilGps,
      Elixir.Mavlink.Send.Mavlink.HilOpticalFlow,
      Elixir.Mavlink.Send.Mavlink.HilRcInputsRaw,
      Elixir.Mavlink.Send.Mavlink.HilSensor,
      Elixir.Mavlink.Send.Mavlink.HilState,
      Elixir.Mavlink.Send.Mavlink.HilStateQuaternion,
      Elixir.Mavlink.Send.Mavlink.HomePosition,
      Elixir.Mavlink.Send.Mavlink.IsbdLinkStatus,
      Elixir.Mavlink.Send.Mavlink.LandingTarget,
      Elixir.Mavlink.Send.Mavlink.LinkNodeStatus,
      Elixir.Mavlink.Send.Mavlink.LocalPositionNed,
      Elixir.Mavlink.Send.Mavlink.LocalPositionNedCov,
      Elixir.Mavlink.Send.Mavlink.LocalPositionNedSystemGlobalOffset,
      Elixir.Mavlink.Send.Mavlink.LogData,
      Elixir.Mavlink.Send.Mavlink.LogEntry,
      Elixir.Mavlink.Send.Mavlink.LogErase,
      Elixir.Mavlink.Send.Mavlink.LogRequestData,
      Elixir.Mavlink.Send.Mavlink.LogRequestEnd,
      Elixir.Mavlink.Send.Mavlink.LogRequestList,
      Elixir.Mavlink.Send.Mavlink.LoggingAck,
      Elixir.Mavlink.Send.Mavlink.LoggingData,
      Elixir.Mavlink.Send.Mavlink.LoggingDataAcked,
      Elixir.Mavlink.Send.Mavlink.ManualControl,
      Elixir.Mavlink.Send.Mavlink.ManualSetpoint,
      Elixir.Mavlink.Send.Mavlink.MemoryVect,
      Elixir.Mavlink.Send.Mavlink.MessageInterval,
      Elixir.Mavlink.Send.Mavlink.MissionAck,
      Elixir.Mavlink.Send.Mavlink.MissionChanged,
      Elixir.Mavlink.Send.Mavlink.MissionClearAll,
      Elixir.Mavlink.Send.Mavlink.MissionCount,
      Elixir.Mavlink.Send.Mavlink.MissionCurrent,
      Elixir.Mavlink.Send.Mavlink.MissionItem,
      Elixir.Mavlink.Send.Mavlink.MissionItemInt,
      Elixir.Mavlink.Send.Mavlink.MissionItemReached,
      Elixir.Mavlink.Send.Mavlink.MissionRequest,
      Elixir.Mavlink.Send.Mavlink.MissionRequestInt,
      Elixir.Mavlink.Send.Mavlink.MissionRequestList,
      Elixir.Mavlink.Send.Mavlink.MissionRequestPartialList,
      Elixir.Mavlink.Send.Mavlink.MissionSetCurrent,
      Elixir.Mavlink.Send.Mavlink.MissionWritePartialList,
      Elixir.Mavlink.Send.Mavlink.MountOrientation,
      Elixir.Mavlink.Send.Mavlink.NamedValueFloat,
      Elixir.Mavlink.Send.Mavlink.NamedValueInt,
      Elixir.Mavlink.Send.Mavlink.NavControllerOutput,
      Elixir.Mavlink.Send.Mavlink.ObstacleDistance,
      Elixir.Mavlink.Send.Mavlink.Odometry,
      Elixir.Mavlink.Send.Mavlink.OpticalFlow,
      Elixir.Mavlink.Send.Mavlink.OpticalFlowRad,
      Elixir.Mavlink.Send.Mavlink.OrbitExecutionStatus,
      Elixir.Mavlink.Send.Mavlink.ParamExtAck,
      Elixir.Mavlink.Send.Mavlink.ParamExtRequestList,
      Elixir.Mavlink.Send.Mavlink.ParamExtRequestRead,
      Elixir.Mavlink.Send.Mavlink.ParamExtSet,
      Elixir.Mavlink.Send.Mavlink.ParamExtValue,
      Elixir.Mavlink.Send.Mavlink.ParamMapRc,
      Elixir.Mavlink.Send.Mavlink.ParamRequestList,
      Elixir.Mavlink.Send.Mavlink.ParamRequestRead,
      Elixir.Mavlink.Send.Mavlink.ParamSet,
      Elixir.Mavlink.Send.Mavlink.ParamValue,
      Elixir.Mavlink.Send.Mavlink.Ping,
      Elixir.Mavlink.Send.Mavlink.PlayTune,
      Elixir.Mavlink.Send.Mavlink.PositionTargetGlobalInt,
      Elixir.Mavlink.Send.Mavlink.PositionTargetLocalNed,
      Elixir.Mavlink.Send.Mavlink.PowerStatus,
      Elixir.Mavlink.Send.Mavlink.ProtocolVersion,
      Elixir.Mavlink.Send.Mavlink.RadioStatus,
      Elixir.Mavlink.Send.Mavlink.RawImu,
      Elixir.Mavlink.Send.Mavlink.RawPressure,
      Elixir.Mavlink.Send.Mavlink.RcChannels,
      Elixir.Mavlink.Send.Mavlink.RcChannelsOverride,
      Elixir.Mavlink.Send.Mavlink.RcChannelsRaw,
      Elixir.Mavlink.Send.Mavlink.RcChannelsScaled,
      Elixir.Mavlink.Send.Mavlink.RequestDataStream,
      Elixir.Mavlink.Send.Mavlink.ResourceRequest,
      Elixir.Mavlink.Send.Mavlink.SafetyAllowedArea,
      Elixir.Mavlink.Send.Mavlink.SafetySetAllowedArea,
      Elixir.Mavlink.Send.Mavlink.ScaledImu,
      Elixir.Mavlink.Send.Mavlink.ScaledImu2,
      Elixir.Mavlink.Send.Mavlink.ScaledImu3,
      Elixir.Mavlink.Send.Mavlink.ScaledPressure,
      Elixir.Mavlink.Send.Mavlink.ScaledPressure2,
      Elixir.Mavlink.Send.Mavlink.ScaledPressure3,
      Elixir.Mavlink.Send.Mavlink.SerialControl,
      Elixir.Mavlink.Send.Mavlink.ServoOutputRaw,
      Elixir.Mavlink.Send.Mavlink.SetActuatorControlTarget,
      Elixir.Mavlink.Send.Mavlink.SetAttitudeTarget,
      Elixir.Mavlink.Send.Mavlink.SetGpsGlobalOrigin,
      Elixir.Mavlink.Send.Mavlink.SetHomePosition,
      Elixir.Mavlink.Send.Mavlink.SetMode,
      Elixir.Mavlink.Send.Mavlink.SetPositionTargetGlobalInt,
      Elixir.Mavlink.Send.Mavlink.SetPositionTargetLocalNed,
      Elixir.Mavlink.Send.Mavlink.SetupSigning,
      Elixir.Mavlink.Send.Mavlink.SimState,
      Elixir.Mavlink.Send.Mavlink.SmartBatteryInfo,
      Elixir.Mavlink.Send.Mavlink.SmartBatteryStatus,
      Elixir.Mavlink.Send.Mavlink.Statustext,
      Elixir.Mavlink.Send.Mavlink.StatustextLong,
      Elixir.Mavlink.Send.Mavlink.StorageInformation,
      Elixir.Mavlink.Send.Mavlink.SysStatus,
      Elixir.Mavlink.Send.Mavlink.SystemTime,
      Elixir.Mavlink.Send.Mavlink.TerrainCheck,
      Elixir.Mavlink.Send.Mavlink.TerrainData,
      Elixir.Mavlink.Send.Mavlink.TerrainReport,
      Elixir.Mavlink.Send.Mavlink.TerrainRequest,
      Elixir.Mavlink.Send.Mavlink.TimeEstimateToTarget,
      Elixir.Mavlink.Send.Mavlink.Timesync,
      Elixir.Mavlink.Send.Mavlink.TrajectoryRepresentationBezier,
      Elixir.Mavlink.Send.Mavlink.TrajectoryRepresentationWaypoints,
      Elixir.Mavlink.Send.Mavlink.UavcanNodeInfo,
      Elixir.Mavlink.Send.Mavlink.UavcanNodeStatus,
      Elixir.Mavlink.Send.Mavlink.UtmGlobalPosition,
      Elixir.Mavlink.Send.Mavlink.V2Extension,
      Elixir.Mavlink.Send.Mavlink.VfrHud,
      Elixir.Mavlink.Send.Mavlink.Vibration,
      Elixir.Mavlink.Send.Mavlink.ViconPositionEstimate,
      Elixir.Mavlink.Send.Mavlink.VideoStreamInformation,
      Elixir.Mavlink.Send.Mavlink.VideoStreamStatus,
      Elixir.Mavlink.Send.Mavlink.VisionPositionEstimate,
      Elixir.Mavlink.Send.Mavlink.VisionSpeedEstimate,
      Elixir.Mavlink.Send.Mavlink.WheelDistance,
      Elixir.Mavlink.Send.Mavlink.WifiConfigAp,
      Elixir.Mavlink.Send.Mavlink.WindCov,
      Elixir.Mavlink.Send.PID,
      Elixir.Mavlink.Send.Port,
      Elixir.Mavlink.Send.Reference,
      Elixir.Mavlink.Send.Tuple,
      Elixir.Mavlink.SerialControl,
      Elixir.Mavlink.ServoOutputRaw,
      Elixir.Mavlink.SetActuatorControlTarget,
      Elixir.Mavlink.SetAttitudeTarget,
      Elixir.Mavlink.SetGpsGlobalOrigin,
      Elixir.Mavlink.SetHomePosition,
      Elixir.Mavlink.SetMode,
      Elixir.Mavlink.SetPositionTargetGlobalInt,
      Elixir.Mavlink.SetPositionTargetLocalNed,
      Elixir.Mavlink.SetupSigning,
      Elixir.Mavlink.SimState,
      Elixir.Mavlink.SmartBatteryInfo,
      Elixir.Mavlink.SmartBatteryStatus,
      Elixir.Mavlink.Statustext,
      Elixir.Mavlink.StatustextLong,
      Elixir.Mavlink.StorageInformation,
      Elixir.Mavlink.SysStatus,
      Elixir.Mavlink.SystemTime,
      Elixir.Mavlink.TerrainCheck,
      Elixir.Mavlink.TerrainData,
      Elixir.Mavlink.TerrainReport,
      Elixir.Mavlink.TerrainRequest,
      Elixir.Mavlink.TimeEstimateToTarget,
      Elixir.Mavlink.Timesync,
      Elixir.Mavlink.TrajectoryRepresentationBezier,
      Elixir.Mavlink.TrajectoryRepresentationWaypoints,
      Elixir.Mavlink.UavcanNodeInfo,
      Elixir.Mavlink.UavcanNodeStatus,
      Elixir.Mavlink.UtmGlobalPosition,
      Elixir.Mavlink.V2Extension,
      Elixir.Mavlink.VfrHud,
      Elixir.Mavlink.Vibration,
      Elixir.Mavlink.ViconPositionEstimate,
      Elixir.Mavlink.VideoStreamInformation,
      Elixir.Mavlink.VideoStreamStatus,
      Elixir.Mavlink.VisionPositionEstimate,
      Elixir.Mavlink.VisionSpeedEstimate,
      Elixir.Mavlink.WheelDistance,
      Elixir.Mavlink.WifiConfigAp,
      Elixir.Mavlink.WindCov],
      Code.compile_file(@output)
      |> Keyword.keys()
      |> Enum.sort())
    
    for {expected, actual} <- pairs do
      assert expected == actual
    end
  end
  
end
