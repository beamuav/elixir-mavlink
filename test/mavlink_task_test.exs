defmodule Mavlink.Test.Tasks do
  use ExUnit.Case
  import Mix.Tasks.Mavlink

  @input "#{File.cwd!()}/test/input/common.xml"
  @output_dir "#{File.cwd!()}/test/output"
  @output "#{@output_dir}/Mavlink.ex"

  test "generate" do
    File.mkdir_p(@output_dir)
    File.rm(@output)
    run([@input, @output])
    assert File.exists?(@output)

    pairs =
      Enum.zip(
        [
          Elixir.Mavlink,
          Elixir.Mavlink.Message.ActuatorControlTarget,
          Elixir.Mavlink.Message.AdsbVehicle,
          Elixir.Mavlink.Message.Altitude,
          Elixir.Mavlink.Message.AttPosMocap,
          Elixir.Mavlink.Message.Attitude,
          Elixir.Mavlink.Message.AttitudeQuaternion,
          Elixir.Mavlink.Message.AttitudeQuaternionCov,
          Elixir.Mavlink.Message.AttitudeTarget,
          Elixir.Mavlink.Message.AuthKey,
          Elixir.Mavlink.Message.AutopilotVersion,
          Elixir.Mavlink.Message.BatteryStatus,
          Elixir.Mavlink.Message.ButtonChange,
          Elixir.Mavlink.Message.CameraCaptureStatus,
          Elixir.Mavlink.Message.CameraImageCaptured,
          Elixir.Mavlink.Message.CameraInformation,
          Elixir.Mavlink.Message.CameraSettings,
          Elixir.Mavlink.Message.CameraTrigger,
          Elixir.Mavlink.Message.ChangeOperatorControl,
          Elixir.Mavlink.Message.ChangeOperatorControlAck,
          Elixir.Mavlink.Message.Collision,
          Elixir.Mavlink.Message.CommandAck,
          Elixir.Mavlink.Message.CommandInt,
          Elixir.Mavlink.Message.CommandLong,
          Elixir.Mavlink.Message.ControlSystemState,
          Elixir.Mavlink.Message.DataStream,
          Elixir.Mavlink.Message.DataTransmissionHandshake,
          Elixir.Mavlink.Message.Debug,
          Elixir.Mavlink.Message.DebugFloatArray,
          Elixir.Mavlink.Message.DebugVect,
          Elixir.Mavlink.Message.DistanceSensor,
          Elixir.Mavlink.Message.EncapsulatedData,
          Elixir.Mavlink.Message.EstimatorStatus,
          Elixir.Mavlink.Message.ExtendedSysState,
          Elixir.Mavlink.Message.FileTransferProtocol,
          Elixir.Mavlink.Message.FlightInformation,
          Elixir.Mavlink.Message.FollowTarget,
          Elixir.Mavlink.Message.GlobalPositionInt,
          Elixir.Mavlink.Message.GlobalPositionIntCov,
          Elixir.Mavlink.Message.GlobalVisionPositionEstimate,
          Elixir.Mavlink.Message.Gps2Raw,
          Elixir.Mavlink.Message.Gps2Rtk,
          Elixir.Mavlink.Message.GpsGlobalOrigin,
          Elixir.Mavlink.Message.GpsInjectData,
          Elixir.Mavlink.Message.GpsInput,
          Elixir.Mavlink.Message.GpsRawInt,
          Elixir.Mavlink.Message.GpsRtcmData,
          Elixir.Mavlink.Message.GpsRtk,
          Elixir.Mavlink.Message.GpsStatus,
          Elixir.Mavlink.Message.Heartbeat,
          Elixir.Mavlink.Message.HighLatency,
          Elixir.Mavlink.Message.HighresImu,
          Elixir.Mavlink.Message.HilActuatorControls,
          Elixir.Mavlink.Message.HilControls,
          Elixir.Mavlink.Message.HilGps,
          Elixir.Mavlink.Message.HilOpticalFlow,
          Elixir.Mavlink.Message.HilRcInputsRaw,
          Elixir.Mavlink.Message.HilSensor,
          Elixir.Mavlink.Message.HilState,
          Elixir.Mavlink.Message.HilStateQuaternion,
          Elixir.Mavlink.Message.HomePosition,
          Elixir.Mavlink.Message.LandingTarget,
          Elixir.Mavlink.Message.LocalPositionNed,
          Elixir.Mavlink.Message.LocalPositionNedCov,
          Elixir.Mavlink.Message.LocalPositionNedSystemGlobalOffset,
          Elixir.Mavlink.Message.LogData,
          Elixir.Mavlink.Message.LogEntry,
          Elixir.Mavlink.Message.LogErase,
          Elixir.Mavlink.Message.LogRequestData,
          Elixir.Mavlink.Message.LogRequestEnd,
          Elixir.Mavlink.Message.LogRequestList,
          Elixir.Mavlink.Message.LoggingAck,
          Elixir.Mavlink.Message.LoggingData,
          Elixir.Mavlink.Message.LoggingDataAcked,
          Elixir.Mavlink.Message.ManualControl,
          Elixir.Mavlink.Message.ManualSetpoint,
          Elixir.Mavlink.Message.MemoryVect,
          Elixir.Mavlink.Message.MessageInterval,
          Elixir.Mavlink.Message.MissionAck,
          Elixir.Mavlink.Message.MissionClearAll,
          Elixir.Mavlink.Message.MissionCount,
          Elixir.Mavlink.Message.MissionCurrent,
          Elixir.Mavlink.Message.MissionItem,
          Elixir.Mavlink.Message.MissionItemInt,
          Elixir.Mavlink.Message.MissionItemReached,
          Elixir.Mavlink.Message.MissionRequest,
          Elixir.Mavlink.Message.MissionRequestInt,
          Elixir.Mavlink.Message.MissionRequestList,
          Elixir.Mavlink.Message.MissionRequestPartialList,
          Elixir.Mavlink.Message.MissionSetCurrent,
          Elixir.Mavlink.Message.MissionWritePartialList,
          Elixir.Mavlink.Message.MountOrientation,
          Elixir.Mavlink.Message.NamedValueFloat,
          Elixir.Mavlink.Message.NamedValueInt,
          Elixir.Mavlink.Message.NavControllerOutput,
          Elixir.Mavlink.Message.ObstacleDistance,
          Elixir.Mavlink.Message.Odometry,
          Elixir.Mavlink.Message.OpticalFlow,
          Elixir.Mavlink.Message.OpticalFlowRad,
          Elixir.Mavlink.Message.ParamMapRc,
          Elixir.Mavlink.Message.ParamRequestList,
          Elixir.Mavlink.Message.ParamRequestRead,
          Elixir.Mavlink.Message.ParamSet,
          Elixir.Mavlink.Message.ParamValue,
          Elixir.Mavlink.Message.Ping,
          Elixir.Mavlink.Message.PlayTune,
          Elixir.Mavlink.Message.PositionTargetGlobalInt,
          Elixir.Mavlink.Message.PositionTargetLocalNed,
          Elixir.Mavlink.Message.PowerStatus,
          Elixir.Mavlink.Message.RadioStatus,
          Elixir.Mavlink.Message.RawImu,
          Elixir.Mavlink.Message.RawPressure,
          Elixir.Mavlink.Message.RcChannels,
          Elixir.Mavlink.Message.RcChannelsOverride,
          Elixir.Mavlink.Message.RcChannelsRaw,
          Elixir.Mavlink.Message.RcChannelsScaled,
          Elixir.Mavlink.Message.RequestDataStream,
          Elixir.Mavlink.Message.ResourceRequest,
          Elixir.Mavlink.Message.SafetyAllowedArea,
          Elixir.Mavlink.Message.SafetySetAllowedArea,
          Elixir.Mavlink.Message.ScaledImu,
          Elixir.Mavlink.Message.ScaledImu2,
          Elixir.Mavlink.Message.ScaledImu3,
          Elixir.Mavlink.Message.ScaledPressure,
          Elixir.Mavlink.Message.ScaledPressure2,
          Elixir.Mavlink.Message.ScaledPressure3,
          Elixir.Mavlink.Message.SerialControl,
          Elixir.Mavlink.Message.ServoOutputRaw,
          Elixir.Mavlink.Message.SetActuatorControlTarget,
          Elixir.Mavlink.Message.SetAttitudeTarget,
          Elixir.Mavlink.Message.SetGpsGlobalOrigin,
          Elixir.Mavlink.Message.SetHomePosition,
          Elixir.Mavlink.Message.SetMode,
          Elixir.Mavlink.Message.SetPositionTargetGlobalInt,
          Elixir.Mavlink.Message.SetPositionTargetLocalNed,
          Elixir.Mavlink.Message.SetupSigning,
          Elixir.Mavlink.Message.SimState,
          Elixir.Mavlink.Message.Statustext,
          Elixir.Mavlink.Message.StatustextLong,
          Elixir.Mavlink.Message.StorageInformation,
          Elixir.Mavlink.Message.SysStatus,
          Elixir.Mavlink.Message.SystemTime,
          Elixir.Mavlink.Message.TerrainCheck,
          Elixir.Mavlink.Message.TerrainData,
          Elixir.Mavlink.Message.TerrainReport,
          Elixir.Mavlink.Message.TerrainRequest,
          Elixir.Mavlink.Message.Timesync,
          Elixir.Mavlink.Message.UavcanNodeInfo,
          Elixir.Mavlink.Message.UavcanNodeStatus,
          Elixir.Mavlink.Message.V2Extension,
          Elixir.Mavlink.Message.VfrHud,
          Elixir.Mavlink.Message.Vibration,
          Elixir.Mavlink.Message.ViconPositionEstimate,
          Elixir.Mavlink.Message.VisionPositionEstimate,
          Elixir.Mavlink.Message.VisionSpeedEstimate,
          Elixir.Mavlink.Message.WheelDistance,
          Elixir.Mavlink.Message.WifiConfigAp,
          Elixir.Mavlink.Message.WindCov,
          Elixir.Mavlink.Pack,
          Elixir.Mavlink.Pack.Atom,
          Elixir.Mavlink.Pack.BitString,
          Elixir.Mavlink.Pack.Float,
          Elixir.Mavlink.Pack.Function,
          Elixir.Mavlink.Pack.Integer,
          Elixir.Mavlink.Pack.List,
          Elixir.Mavlink.Pack.Map,
          Elixir.Mavlink.Pack.Mavlink.Message.ActuatorControlTarget,
          Elixir.Mavlink.Pack.Mavlink.Message.AdsbVehicle,
          Elixir.Mavlink.Pack.Mavlink.Message.Altitude,
          Elixir.Mavlink.Pack.Mavlink.Message.AttPosMocap,
          Elixir.Mavlink.Pack.Mavlink.Message.Attitude,
          Elixir.Mavlink.Pack.Mavlink.Message.AttitudeQuaternion,
          Elixir.Mavlink.Pack.Mavlink.Message.AttitudeQuaternionCov,
          Elixir.Mavlink.Pack.Mavlink.Message.AttitudeTarget,
          Elixir.Mavlink.Pack.Mavlink.Message.AuthKey,
          Elixir.Mavlink.Pack.Mavlink.Message.AutopilotVersion,
          Elixir.Mavlink.Pack.Mavlink.Message.BatteryStatus,
          Elixir.Mavlink.Pack.Mavlink.Message.ButtonChange,
          Elixir.Mavlink.Pack.Mavlink.Message.CameraCaptureStatus,
          Elixir.Mavlink.Pack.Mavlink.Message.CameraImageCaptured,
          Elixir.Mavlink.Pack.Mavlink.Message.CameraInformation,
          Elixir.Mavlink.Pack.Mavlink.Message.CameraSettings,
          Elixir.Mavlink.Pack.Mavlink.Message.CameraTrigger,
          Elixir.Mavlink.Pack.Mavlink.Message.ChangeOperatorControl,
          Elixir.Mavlink.Pack.Mavlink.Message.ChangeOperatorControlAck,
          Elixir.Mavlink.Pack.Mavlink.Message.Collision,
          Elixir.Mavlink.Pack.Mavlink.Message.CommandAck,
          Elixir.Mavlink.Pack.Mavlink.Message.CommandInt,
          Elixir.Mavlink.Pack.Mavlink.Message.CommandLong,
          Elixir.Mavlink.Pack.Mavlink.Message.ControlSystemState,
          Elixir.Mavlink.Pack.Mavlink.Message.DataStream,
          Elixir.Mavlink.Pack.Mavlink.Message.DataTransmissionHandshake,
          Elixir.Mavlink.Pack.Mavlink.Message.Debug,
          Elixir.Mavlink.Pack.Mavlink.Message.DebugFloatArray,
          Elixir.Mavlink.Pack.Mavlink.Message.DebugVect,
          Elixir.Mavlink.Pack.Mavlink.Message.DistanceSensor,
          Elixir.Mavlink.Pack.Mavlink.Message.EncapsulatedData,
          Elixir.Mavlink.Pack.Mavlink.Message.EstimatorStatus,
          Elixir.Mavlink.Pack.Mavlink.Message.ExtendedSysState,
          Elixir.Mavlink.Pack.Mavlink.Message.FileTransferProtocol,
          Elixir.Mavlink.Pack.Mavlink.Message.FlightInformation,
          Elixir.Mavlink.Pack.Mavlink.Message.FollowTarget,
          Elixir.Mavlink.Pack.Mavlink.Message.GlobalPositionInt,
          Elixir.Mavlink.Pack.Mavlink.Message.GlobalPositionIntCov,
          Elixir.Mavlink.Pack.Mavlink.Message.GlobalVisionPositionEstimate,
          Elixir.Mavlink.Pack.Mavlink.Message.Gps2Raw,
          Elixir.Mavlink.Pack.Mavlink.Message.Gps2Rtk,
          Elixir.Mavlink.Pack.Mavlink.Message.GpsGlobalOrigin,
          Elixir.Mavlink.Pack.Mavlink.Message.GpsInjectData,
          Elixir.Mavlink.Pack.Mavlink.Message.GpsInput,
          Elixir.Mavlink.Pack.Mavlink.Message.GpsRawInt,
          Elixir.Mavlink.Pack.Mavlink.Message.GpsRtcmData,
          Elixir.Mavlink.Pack.Mavlink.Message.GpsRtk,
          Elixir.Mavlink.Pack.Mavlink.Message.GpsStatus,
          Elixir.Mavlink.Pack.Mavlink.Message.Heartbeat,
          Elixir.Mavlink.Pack.Mavlink.Message.HighLatency,
          Elixir.Mavlink.Pack.Mavlink.Message.HighresImu,
          Elixir.Mavlink.Pack.Mavlink.Message.HilActuatorControls,
          Elixir.Mavlink.Pack.Mavlink.Message.HilControls,
          Elixir.Mavlink.Pack.Mavlink.Message.HilGps,
          Elixir.Mavlink.Pack.Mavlink.Message.HilOpticalFlow,
          Elixir.Mavlink.Pack.Mavlink.Message.HilRcInputsRaw,
          Elixir.Mavlink.Pack.Mavlink.Message.HilSensor,
          Elixir.Mavlink.Pack.Mavlink.Message.HilState,
          Elixir.Mavlink.Pack.Mavlink.Message.HilStateQuaternion,
          Elixir.Mavlink.Pack.Mavlink.Message.HomePosition,
          Elixir.Mavlink.Pack.Mavlink.Message.LandingTarget,
          Elixir.Mavlink.Pack.Mavlink.Message.LocalPositionNed,
          Elixir.Mavlink.Pack.Mavlink.Message.LocalPositionNedCov,
          Elixir.Mavlink.Pack.Mavlink.Message.LocalPositionNedSystemGlobalOffset,
          Elixir.Mavlink.Pack.Mavlink.Message.LogData,
          Elixir.Mavlink.Pack.Mavlink.Message.LogEntry,
          Elixir.Mavlink.Pack.Mavlink.Message.LogErase,
          Elixir.Mavlink.Pack.Mavlink.Message.LogRequestData,
          Elixir.Mavlink.Pack.Mavlink.Message.LogRequestEnd,
          Elixir.Mavlink.Pack.Mavlink.Message.LogRequestList,
          Elixir.Mavlink.Pack.Mavlink.Message.LoggingAck,
          Elixir.Mavlink.Pack.Mavlink.Message.LoggingData,
          Elixir.Mavlink.Pack.Mavlink.Message.LoggingDataAcked,
          Elixir.Mavlink.Pack.Mavlink.Message.ManualControl,
          Elixir.Mavlink.Pack.Mavlink.Message.ManualSetpoint,
          Elixir.Mavlink.Pack.Mavlink.Message.MemoryVect,
          Elixir.Mavlink.Pack.Mavlink.Message.MessageInterval,
          Elixir.Mavlink.Pack.Mavlink.Message.MissionAck,
          Elixir.Mavlink.Pack.Mavlink.Message.MissionClearAll,
          Elixir.Mavlink.Pack.Mavlink.Message.MissionCount,
          Elixir.Mavlink.Pack.Mavlink.Message.MissionCurrent,
          Elixir.Mavlink.Pack.Mavlink.Message.MissionItem,
          Elixir.Mavlink.Pack.Mavlink.Message.MissionItemInt,
          Elixir.Mavlink.Pack.Mavlink.Message.MissionItemReached,
          Elixir.Mavlink.Pack.Mavlink.Message.MissionRequest,
          Elixir.Mavlink.Pack.Mavlink.Message.MissionRequestInt,
          Elixir.Mavlink.Pack.Mavlink.Message.MissionRequestList,
          Elixir.Mavlink.Pack.Mavlink.Message.MissionRequestPartialList,
          Elixir.Mavlink.Pack.Mavlink.Message.MissionSetCurrent,
          Elixir.Mavlink.Pack.Mavlink.Message.MissionWritePartialList,
          Elixir.Mavlink.Pack.Mavlink.Message.MountOrientation,
          Elixir.Mavlink.Pack.Mavlink.Message.NamedValueFloat,
          Elixir.Mavlink.Pack.Mavlink.Message.NamedValueInt,
          Elixir.Mavlink.Pack.Mavlink.Message.NavControllerOutput,
          Elixir.Mavlink.Pack.Mavlink.Message.ObstacleDistance,
          Elixir.Mavlink.Pack.Mavlink.Message.Odometry,
          Elixir.Mavlink.Pack.Mavlink.Message.OpticalFlow,
          Elixir.Mavlink.Pack.Mavlink.Message.OpticalFlowRad,
          Elixir.Mavlink.Pack.Mavlink.Message.ParamMapRc,
          Elixir.Mavlink.Pack.Mavlink.Message.ParamRequestList,
          Elixir.Mavlink.Pack.Mavlink.Message.ParamRequestRead,
          Elixir.Mavlink.Pack.Mavlink.Message.ParamSet,
          Elixir.Mavlink.Pack.Mavlink.Message.ParamValue,
          Elixir.Mavlink.Pack.Mavlink.Message.Ping,
          Elixir.Mavlink.Pack.Mavlink.Message.PlayTune,
          Elixir.Mavlink.Pack.Mavlink.Message.PositionTargetGlobalInt,
          Elixir.Mavlink.Pack.Mavlink.Message.PositionTargetLocalNed,
          Elixir.Mavlink.Pack.Mavlink.Message.PowerStatus,
          Elixir.Mavlink.Pack.Mavlink.Message.RadioStatus,
          Elixir.Mavlink.Pack.Mavlink.Message.RawImu,
          Elixir.Mavlink.Pack.Mavlink.Message.RawPressure,
          Elixir.Mavlink.Pack.Mavlink.Message.RcChannels,
          Elixir.Mavlink.Pack.Mavlink.Message.RcChannelsOverride,
          Elixir.Mavlink.Pack.Mavlink.Message.RcChannelsRaw,
          Elixir.Mavlink.Pack.Mavlink.Message.RcChannelsScaled,
          Elixir.Mavlink.Pack.Mavlink.Message.RequestDataStream,
          Elixir.Mavlink.Pack.Mavlink.Message.ResourceRequest,
          Elixir.Mavlink.Pack.Mavlink.Message.SafetyAllowedArea,
          Elixir.Mavlink.Pack.Mavlink.Message.SafetySetAllowedArea,
          Elixir.Mavlink.Pack.Mavlink.Message.ScaledImu,
          Elixir.Mavlink.Pack.Mavlink.Message.ScaledImu2,
          Elixir.Mavlink.Pack.Mavlink.Message.ScaledImu3,
          Elixir.Mavlink.Pack.Mavlink.Message.ScaledPressure,
          Elixir.Mavlink.Pack.Mavlink.Message.ScaledPressure2,
          Elixir.Mavlink.Pack.Mavlink.Message.ScaledPressure3,
          Elixir.Mavlink.Pack.Mavlink.Message.SerialControl,
          Elixir.Mavlink.Pack.Mavlink.Message.ServoOutputRaw,
          Elixir.Mavlink.Pack.Mavlink.Message.SetActuatorControlTarget,
          Elixir.Mavlink.Pack.Mavlink.Message.SetAttitudeTarget,
          Elixir.Mavlink.Pack.Mavlink.Message.SetGpsGlobalOrigin,
          Elixir.Mavlink.Pack.Mavlink.Message.SetHomePosition,
          Elixir.Mavlink.Pack.Mavlink.Message.SetMode,
          Elixir.Mavlink.Pack.Mavlink.Message.SetPositionTargetGlobalInt,
          Elixir.Mavlink.Pack.Mavlink.Message.SetPositionTargetLocalNed,
          Elixir.Mavlink.Pack.Mavlink.Message.SetupSigning,
          Elixir.Mavlink.Pack.Mavlink.Message.SimState,
          Elixir.Mavlink.Pack.Mavlink.Message.Statustext,
          Elixir.Mavlink.Pack.Mavlink.Message.StatustextLong,
          Elixir.Mavlink.Pack.Mavlink.Message.StorageInformation,
          Elixir.Mavlink.Pack.Mavlink.Message.SysStatus,
          Elixir.Mavlink.Pack.Mavlink.Message.SystemTime,
          Elixir.Mavlink.Pack.Mavlink.Message.TerrainCheck,
          Elixir.Mavlink.Pack.Mavlink.Message.TerrainData,
          Elixir.Mavlink.Pack.Mavlink.Message.TerrainReport,
          Elixir.Mavlink.Pack.Mavlink.Message.TerrainRequest,
          Elixir.Mavlink.Pack.Mavlink.Message.Timesync,
          Elixir.Mavlink.Pack.Mavlink.Message.UavcanNodeInfo,
          Elixir.Mavlink.Pack.Mavlink.Message.UavcanNodeStatus,
          Elixir.Mavlink.Pack.Mavlink.Message.V2Extension,
          Elixir.Mavlink.Pack.Mavlink.Message.VfrHud,
          Elixir.Mavlink.Pack.Mavlink.Message.Vibration,
          Elixir.Mavlink.Pack.Mavlink.Message.ViconPositionEstimate,
          Elixir.Mavlink.Pack.Mavlink.Message.VisionPositionEstimate,
          Elixir.Mavlink.Pack.Mavlink.Message.VisionSpeedEstimate,
          Elixir.Mavlink.Pack.Mavlink.Message.WheelDistance,
          Elixir.Mavlink.Pack.Mavlink.Message.WifiConfigAp,
          Elixir.Mavlink.Pack.Mavlink.Message.WindCov,
          Elixir.Mavlink.Pack.PID,
          Elixir.Mavlink.Pack.Port,
          Elixir.Mavlink.Pack.Reference,
          Elixir.Mavlink.Pack.Tuple
        ],
        Code.compile_file(@output)
        |> Keyword.keys()
        |> Enum.sort()
      )

    for {expected, actual} <- pairs do
      assert expected == actual
    end
  end
end
